<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora da Menopausa - MRS</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Quicksand', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      color: #FFFFFF; 
      background-color: #886BD0;
    }

    * a{
      text-decoration: none;
    }
    
    .logo {
      fill: #FFFFFF;
    }

    .logo img {
      width: 54.36px;
      height: auto;
      filter: brightness(0) invert(1);
    }
    
    .welcome-layout {
      height: 100vh;
      width: auto;
      display: flex;
      justify-content: space-around;
      align-items: center;
    }

    .welcome {
      display: flex;
      flex-direction: column;
      text-align: start;
      width: 712px;
      height: 389px;
      gap: 20px;
    }
    
    .result-container {
      height: 100vh;
      width: 100%;
      display: none;
      justify-content: space-around;
    }

    .welcome-layout-final {
      height: 100vh;
      width: 100%;
      display: flex;
      justify-content: space-around;
      align-items: center;
    }

    .welcome-final {
      display: flex;
      flex-direction: column;
      text-align: start;
      width: 712px;
      height: 269px;
      gap: 20px;
    }
    
    .welcome-title {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 20px;
      color: #886BD0;
    }
    
    .welcome-subtitle {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 20px;
      color: #886BD0;
    }
    
    .welcome-text {
      font-size: 16px;
      line-height: 1.6;
      margin-bottom: 20px;
      max-width: 600px;
      text-align: left;
    }
    
    .feature-list {
      text-align: left;
      margin-bottom: 30px;
      width: 100%;
      max-width: 600px;
    }
    
    .feature-item {
      margin-bottom: 15px;
      position: relative;
      padding-left: 25px;
    }
    
    .feature-item:before {
      content: "🔸";
      position: absolute;
      left: 0;
    }
    
    .feature-highlight {
      font-weight: 700;
    }
    
    .prompt-title {
      font-size: 48px;
      font-weight: 700;
      line-height: 52px;
      letter-spacing: 0%;
      color: #FFFFFF;
      margin-bottom: 0;
    }

    .prompt-text {
      font-size: 20px;
      line-height: 100%;
      letter-spacing: 0;
      font-weight: 500;
      color: #FFFFFF;
    }
    
    .start-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(255, 255, 255, 0.2);
      color: #FFFFFF;
      width: 339px;
      height: 55px;
      border-radius: 100px;
      border: solid 1px #FFFFFF;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 20px;
      font-weight: 700;
      line-height: 100%;
      padding: 25px 15px;
      margin-top: 20px;
    }

    .start-btn img {
      margin: 2.5px 0 2.5px 10px;
      width: 20px;
      height: 20px;
    }
    
    .start-btn:hover {
      color:#886BD0;
      background-color: #f5f5f5;
      box-shadow: 0 4px 10px rgba(255, 255, 255, 0.3);
    }
    
    .quiz-container {
      height: 100vh;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: start;
      overflow-wrap: break-word;
    }
    
    .question-container {
      width: 1230px;
      height: auto;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: start;
      transition: opacity 0.5s ease;
      margin-left: 162px;
      gap: 20px;
    }
    
    .question-text {
      margin-bottom: 20px;
      font-weight: 700;
      font-size: 48px;
      line-height: 52px;
      color: #FFFFFF;
    }
    
    .options-container {
      display: flex;
      gap: 15px;
    }

    .question-opciones {
      font-size: 18px;
    }
    
    .option-btn {
      background-color: rgba(255, 255, 255, 0.2);
      width: 230px;
      height: 55px;
      border-radius: 200px;
      border: 1px solid #FFFFFF;
      padding: 15px 25px;
      gap: 10px;
      transition: all 0.2s ease;
      cursor: pointer;
      font-weight: 500;
      font-size: 20px;
      line-height: 100%;
      color: #FFFFFF;
    }

    
    .option-btn:hover {
      background-color: #FFFFFF;
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(154, 138, 193, 0.2);
      border-color: #886BD0;
      color: #886BD0;
    }
  
    
    .progress-container {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
    }
    
    .progress-bar {
      height: 25px;
      width: 100%;
      background-color: white;
      width: 0%;
      transition: width 0.5s ease;
      border-radius: 3px;
    }

    .layout-btns {
      width: 70%;
      display: flex;
      justify-content: start;
      align-items: center;
      gap: 40px;
    }
    
    .result-card {
      display: flex;
      justify-content: center;
      align-items: center;
      width: auto;
      height: 55px;
      border-radius: 100px;
      padding: 15px 25px;
      font-weight: 700;
      font-size: 20px;
      line-height: 100%;
      text-align: center;
      cursor: pointer;
    }

    .result-title {
      width: 100%;
      font-size: 42px;
      font-weight: 700;
      margin-bottom: 20px;
      color: white;
    }
    
    .asintomatico { background-color: #F1F1F1;
    color: #886BD0; }

    .asintomatico-logo img {
      filter: none;
    }

    .leve { background-color: #32A852; }
    .moderado { background-color: #EBAC24; }
    .severo { background-color: #E94335; }

    .asintomatico-btn, .asintomatico-btn-f5 {
      background-color: rgba(136, 107, 208, 0.2);
      border: 1px solid #886BD0;
      color: #886BD0;
    }


    .asintomatico-btn:hover {
      background-color: #886BD0;
      color: #FFFFFF;
    }

    .leve-btn, .leve-btn-f5 {
      background-color: rgba(255, 255, 255, 0.2);
      border: 1px solid #FFFFFF;
      color: #FFFFFF;
    }
    
    
    .leve-btn:hover {
      background-color: #FFFFFF;
      color: #32A852;
    }

    .moderado-btn, .moderado-btn-f5 {
      background-color: rgba(255, 255, 255, 0.2);
      border: 1px solid #FFFFFF;
      color: #FFFFFF;
    }

    .moderado-btn:hover {
      background-color: #FFFFFF;
      color: #EBAC24;
    }
    
    .severo-btn, .severo-btn-f5 {
      background-color: rgba(255, 255, 255, 0.2);
      border: 1px solid #FFFFFF;
      color: #FFFFFF;
    }

    .severo-btn:hover {
      background-color: #FFFFFF;
      color: #E94335;
    }
    
    .reset-btn {
      background-color: transparent;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 20px;
      border: none;
      width: 138px;
      height: 36px;
      gap: 20px;
      font-weight: 500;
      font-size: 14px;
      line-height: 100%;
      cursor: pointer;
      gap: 0px;
    }

    .white-reset {
      filter: brightness(0) invert(1);
    }

    .reset-btn--img {
      width: 16px;
      height: 16px;
    }
    
    .question-counter {
      width: 40px;
      height: 40px;
      border-radius: 200px;
      background-color: #FFFFFF;
      font-weight: 700;
      font-size: 20px;
      line-height: 52px;
      color: #886BD0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .welcome-image {
      display: flex;
      justify-content: center;
      align-items: center;
      
    }
    .welcome-image img {
          width: 500px;
          height: auto;
          object-fit: cover;
          border-radius: 20px;
          margin-bottom: 40px;
    }

    .welcome-image--mobile {
      display: none;
      justify-content: center;
      align-items: center;
      
    }
    .welcome-image--mobile img {
          width: 500px;
          height: auto;
          object-fit: cover;
          border-radius: 20px;
          margin-bottom: 40px;
    }
    
    @media (max-width: 768px) {

      .result-title {
        font-size: 28px;
      margin-bottom: 0px;
    }

      .welcome-image--mobile {
      display: flex;    
    }
    
    .welcome-image--mobile img {
          width: 280px;
          margin-bottom: 0px;
    }
      .welcome-layout {
        display: flex;
        flex-direction: column;
      }

      .welcome {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 32px;
        height: auto;
        width: auto;
      }

      .prompt-title {
        font-size: 32px;
        line-height: 36px;
      }

      .prompt-text {
        line-height: 24px;
      }

      .welcome-image {
      display: none;  
    }

    .quiz-container {
      width: 100%;
      height: 100%;
      justify-content: center;
      align-items: center;
      overflow-wrap: break-word;
      overflow-y: hidden;
    }
    
    .question-container {
      width: 100%;
      height: 30%;
      display: flex;
      flex-direction: flex;
      justify-content: center;
      align-items: center;
      margin-left: 0px;
      padding: 32px;
      gap: 0px;
    }

    .options-container {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-top: 20px;
      justify-content: center;
      margin-bottom: 0px;
    }

    .question-text {
      font-size: 28px;
      line-height: 32px;
      margin: 32px 0;
      text-align: center;
    }

    .question-counter {
      width: 32px;
      height: 32px;
      font-size: 16px;
    }

    .welcome-layout-final {
      display: block;
    }

    .welcome-final {
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 32px;
      height: auto;
      width: auto;
      gap: 20px;
    }
    
    .layout-btns {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .reset-btn {
      margin-left: 0px;
      margin-top: 0px;
    }

    .progress-container {
      top: 0;
      height: 25px;
    }
  }
  </style>
</head>
<body>
  <div id="welcome-layout" class="welcome-layout">
    <div class="welcome">
      <div class="logo">
        <img src="./logo.svg" alt="logo">
      </div>
      <div class="welcome-image--mobile">
        <img src="./IMAGEM.png" alt="test">
      </div>
      <h2 class="prompt-title">Avalie a escala da sua menopausa em minutos!</h2>
      <span class="prompt-text">A Escala de Avaliação da Menopausa (Menopause Rating Scale – MRS) avalia a qualidade de vida e os sintomas do climatério através de 11 questões distribuídas em 3 subescalas: sintomas somato-vegetativos, psicológicos e urogenitais.</span>
      <button class="start-btn" onclick="startQuiz()">INICIAR AVALIAÇÃO GRÁTIS
        <img src="./setaprolado.svg" alt="icone">
      </button>
    </div>
    <div class="welcome-image">
      <img src="./IMAGEM.png" alt="test">
    </div>
  </div>
  <div id="quiz-container" class="quiz-container">
    <div id="question-container" class="question-container" style="opacity: 0;">
      <!-- Question content will be inserted here by JavaScript -->
    </div>
    <div id="result-container" class="result-container" style="display: none">
      <!-- Result content will be inserted here by JavaScript -->
    </div>
  </div>
    <div class="progress-container" id="progress-container">
      <div class="progress-bar" id="progress-bar"></div>
    </div>
  </div>
  
  <script>

    // At the top of your script
let resultSubmitted = false;

// Then modify your showResult function
function showResult() {
  // Only register if not already submitted
  if (!resultSubmitted) {
    const totalScore = scores.reduce((sum, score) => sum + score, 0);
    const classification = getClassification(totalScore);
    
    // Register result and set flag to true
    registrarResultado(classification.text);
    resultSubmitted = true;
    
    // Rest of your showResult code...
  }
}

// And reset the flag when quiz is reset
function resetQuiz() {
  resultSubmitted = false;
  // Rest of your resetQuiz code...
}
    const questions = [
      "Sua sensação de falta de ar, suores, calores:",
      "Mal estar do coração (batidas do coração diferentes, saltos nas batidas, batidas mais longas, pressão):",
      "Problemas de sono (dificuldade em conciliar o sono, em dormir a noite toda e acordar muito cedo):",
      "Estado de ânimo depressivo (sentir-se para baixo, triste, a ponto das lágrimas, falta de vontade, instabilidade de humor):",
      "Irritabilidade (sentir-se nervosa, tensa, agressiva):",
      "Ansiedade (impaciência, pânico):",
      "Esgotamento físico e mental (queda geral em seu desempenho, falta de energia):",
      "Problemas sexuais (falta no desejo sexual, na atividade e satisfação):",
      "Problemas de bexiga (dificuldade de urinar, incontinência, desejo excessivo de urinar):",
      "Ressecamento vaginal (sensação de ressecamento, ardência e problemas durante a relação sexual):",
      "Problemas musculares e nas articulações (dores reumáticas e nas articulações):"
    ];
    
    const optionLabels = [
      "Nenhum",
      "Pouco",
      "Moderado",
      "Severa",
      "Muito severa"
    ];
    
    let currentQuestion = 0;
    let scores = Array(questions.length).fill(null);
    const welcomeLayout = document.getElementById("welcome-layout");
    const quizContainer = document.getElementById("quiz-container");
    const questionContainer = document.getElementById("question-container");
    const resultContainer = document.getElementById("result-container");
    const progressBar = document.getElementById("progress-bar");
    const progressContainer = document.getElementById("progress-container")
    
    // Inicia o quiz ao clicar no botão iniciar
    function startQuiz() {
      welcomeLayout.style.display = "none";
      quizContainer.style.display = "flex";
      
      setTimeout(() => {
        renderQuestion();
        questionContainer.style.opacity = 1;
      }, 100);
    }
    
// Renderiza a questão atual
function renderQuestion() {
  // Remove any existing question counter first
  const existingCounter = document.querySelector(".question-counter");
  if (existingCounter) {
    existingCounter.remove();
  }
  
  // Cria o contador de questões
  const counter = document.createElement("div");
  counter.className = "question-counter";
  counter.textContent = `${currentQuestion + 1}`;
  
  // Cria o texto da questão
  const questionText = document.createElement("div");
  questionText.className = "question-text";
  questionText.textContent = questions[currentQuestion];
  
  // Cria o container de opções
  const optionsContainer = document.createElement("div");
  optionsContainer.className = "options-container";
  
  // Adiciona as opções
  for (let i = 0; i < optionLabels.length; i++) {
    const optionBtn = document.createElement("button");
    optionBtn.className = "option-btn";
    optionBtn.addEventListener("click", () => selectOption(i));
    
    const label = document.createElement("span");
    label.textContent = optionLabels[i];
    label.classList.add("question-opciones");
    
    optionBtn.appendChild(label);
    optionsContainer.appendChild(optionBtn);
  }
  
  // Limpa o container de questão e adiciona os novos elementos
  questionContainer.innerHTML = '';
  questionContainer.appendChild(counter);
  questionContainer.appendChild(questionText);
  questionContainer.appendChild(optionsContainer);
  
  // Atualiza a barra de progresso
  const progress = (currentQuestion / questions.length) * 100;
  progressBar.style.width = `${progress}%`;
}
    
    // Seleciona uma opção e avança para a próxima pergunta
    function selectOption(value) {
      scores[currentQuestion] = value;
      
      // Efeito de fade out
      questionContainer.style.opacity = 0;
      
      setTimeout(() => {
        currentQuestion++;
        
        if (currentQuestion < questions.length) {
          renderQuestion();
          // Efeito de fade in
          setTimeout(() => {
            questionContainer.style.opacity = 1;
          }, 100);
        } else {
          showResult();
        }
      }, 500);
    }
    
    // Determina a classificação com base na pontuação
    // Determine the classification based on the score
function getClassification(score) {
  if (score <= 4) {
    return {
      text: "ASSINTOMÁTICA",
      class: "asintomatico",
      classBtn: "asintomatico-btn",
      img: "asintomatico-logo",
      setaclass: "asintomatico-seta",
      resetClass: "asintomatico-reset",
      f5: "asintomatico-btn-f5"
    };
  } else if (score >= 5 && score <= 8) {
    return {
      text: "LEVE",
      class: "leve",
      classBtn: "leve-btn",
      img: "leve-logo",
      setaclass: "leve-seta",
      resetClass: "white-reset",
      f5: "leve-btn-f5"
    };
  } else if (score >= 9 && score <= 15) {
    return {
      text: "MODERADO",
      class: "moderado",
      classBtn: "moderado-btn",
      img: "leve-logo",
      setaclass: "asintomatico-seta",
      resetClass: "white-reset",
      f5: "moderado-btn-f5"
    };
  } else {
    return {
      text: "SEVERO",
      class: "severo",
      classBtn: "severo-btn",
      img: "leve-logo",
      setaclass: "asintomatico-seta",
      resetClass: "white-reset",
      f5: "severo-btn-f5"
    };
  }
}

// Function to register the result in Google Sheets
// Add this variable outside the function to track the last submission time
let lastSubmissionTime = 0;

function registrarResultado(resultado) {
  // Get current time
  const currentTime = Date.now();
  
  // Check if 5 seconds (5000ms) have passed since last submission
  if (currentTime - lastSubmissionTime < 5000) {
    console.log('Cooldown active, waiting before submitting again');
    return; // Exit the function without submitting
  }
  
  // Update the last submission time
  lastSubmissionTime = currentTime;
  
  // URL of your Google Apps Script API
  const apiUrl = 'https://script.google.com/macros/s/AKfycbymPdM8azAL0ZyiXDLfjEgR8lh2XFsN_UL24NWkNHQn6LmG2tXDgu0hkR3zASCM2H8dqA/exec';
  
  // Log that we're attempting to send data
  console.log('Attempting to send data:', resultado);
  
  fetch(apiUrl, {
    method: 'POST',
    mode: 'no-cors', // This is important for cross-origin requests
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      resultado: resultado.toLowerCase() // Send in lowercase to facilitate comparison
    })
  })
  .then(response => {
    console.log('Raw response:', response);
    // When using no-cors, we cannot read the response body directly
    return { success: true };
  })
  .then(data => {
    console.log('Result registered successfully:', data);
  })
  .catch(error => {
    console.error('Error registering result:', error);
  });
}

// Show the final result
function showResult() {
  const totalScore = scores.reduce((sum, score) => sum + score, 0);
  const classification = getClassification(totalScore);
  
  console.log('Total score:', totalScore);
  console.log('Classification:', classification.text);
  
  // Register the result in Google Sheets
  registrarResultado(classification.text);
  
  questionContainer.style.display = "none";
  progressContainer.style.display = "none";
  resultContainer.style.display = "flex";
  
  // Define the image based on the classification
  let imageSrc = "";
  let altText = "";
  
  switch(classification.class) {
    case "asintomatico":
      imageSrc = "./sem.png";
      altText = "Assintomático ou Escasso";
      break;
    case "leve":
      imageSrc = "leve.png";
      altText = "Leve";
      break;
    case "moderado":
      imageSrc = "moderado.png";
      altText = "Moderado";
      break;
    case "severo":
      imageSrc = "severo.png";
      altText = "Severo";
      break;
  }

  // Select the .quiz-container element
  const quizContainer = document.querySelector('.quiz-container');

  // Modify the background-color of .quiz-container according to the classification
  switch (classification.class) {
    case "asintomatico":
      quizContainer.style.backgroundColor = '#F1F1F1';
      break;
    case "leve":
      quizContainer.style.backgroundColor = '#32A852';
      break;
    case "moderado":
      quizContainer.style.backgroundColor = '#EBAC24';
      break;
    case "severo":
      quizContainer.style.backgroundColor = '#E94335';
      break;
  }

  // Update the resultContainer content with the data
  resultContainer.innerHTML = `
    <div class="welcome-layout-final ${classification.class}">
      <div class="welcome-final">
        <div class="logo ${classification.img}">
        <img src="./logo.svg " alt="logo">
        </div>
        <div class="welcome-image--mobile">
        <img src="${imageSrc}" alt="${altText}" class="result-image">
        </div>
        <h2 class="result-title ${classification.class}">Suas respostas indicam que<br> sua menopausa é ${classification.text}</h2>
        <div class="layout-btns">
          <a href="#">
          <button class="result-card ${classification.classBtn}">
            AGENDAR CONSULTA
          </button>
        </a>
        <button class="reset-btn ${classification.f5}" onclick="resetQuiz()">
          <img class="reset-btn--img ${classification.resetClass}" src="./seta.svg" alt="reset">
          Aperte F5 para reiniciar o teste</button>
        </div>
      </div>
      <div class="welcome-image">
        <img src="${imageSrc}" alt="${altText}" class="result-image">
      </div>
    </div>
  `;
  
  // Complete the progress bar
  progressBar.style.width = "100%";
  
  // Remove the question counter when showing the result
  const counter = document.querySelector(".question-counter");
  if (counter) counter.remove();
}
    
    // Reinicia o quiz
    function resetQuiz() {
      currentQuestion = 0;
      scores = Array(questions.length).fill(null);
      resultContainer.style.display = "none";
      
      // Volta para a tela inicial
      quizContainer.style.display = "none";
      quizContainer.style.backgroundColor = "#886BD0";
      welcomeLayout.style.display = "flex";
      progressBar.style.width = "0%";
      questionContainer.style.opacity = 0;
      questionContainer.style.display = "flex";
    }
  </script>
</body>
</html>